\chapter{Scattering of X-rays}
\label{ch:scattering}
\section{Transverse Electromagnetic Waves}
% Big too long and tedious. Maybe just a short introduction to the wave-particle duality of x-rays.
As mentioned in Section \ref{sec:CT_Xrays}, X-rays are electromagnetic waves.
Furthermore, X-rays can be expressed as plane waves, or Transverse electromagnetic waves, TEM-waves, assuming they are unbound, coherent, and monochromatic.
TEM-waves are characterised by a magnetic field $\vectorBU{H}$ and an electric field $\vectorBU{E}$ that are perpendicular to each other and to the direction of propagation, which is parallel to the wave vector $\vectorBU{k}$.
%The mentioned fields and the Poynting vector may all be derived from the vector potential $A$.
A TEM wave may be expressed in terms of time $t$ and position $\vectorBU{r}$ of its electric field $\vectorBU{E}$,
\begin{equation}\label{eq:TEM_wave}
    \vectorBU{E}(\vectorBU{r},t) = \vectorgreek{\widehat{\epsilon}} \left. \right.  E_{0} \exp\left(-i\left(\omega t - \vectorBU{k}\cdot\vectorBU{r}\right)\right),
\end{equation}
where $\vectorgreek{\widehat{\epsilon}}$, $E_{0}$, $\omega$, and $\vectorBU{k}$ are the electric field unit vector, its corresponding amplitude, the wave angular frequency, and the wave vector, respectively.
% In turn, the electric field may be expressed in terms of a vector potential $\vectorBU{A}$ and a scalar potential $\phi$. 
% Consequently, it is possible to derive an equivalent wave equation with respect to the vector potential, and thus a solution in the form of a vector potential. 
% RSD: Something like this. Check if necessary...

Therefore, scattering events between X-rays and electrons, for instance, can be described by
exertion of force between the electric field of the wave and the charge of the electrons \cite{mcmorrow2011elements}.
This description will be elaborated in the following section, Section \ref{sec:classical_scattering}.

% However, quantisation of photons, which is performed within the scope of quantum mechanics, results in X-rays being described as photons.
% This is a more useful description of X-rays in terms of scattering events, because it allows for particle-particle interactions between photons and electrons,
% with transfer of momentum, elastic scattering, but also energy in inelastic scattering events \cite{mcmorrow2011elements}.

% The definition of the "differential scattering crossection", seen in Equation \eqref{eq:scattering_crossection},
% is also more intuitive from the perspective of quantisation.
% The differential scattering crossection is the number of photons scattered relative to number of incoming photons per unit solid angle and time.
% Mathematically, this is expressed in terms of scattering intensity $I_{s}$, the incoming flux $\Phi_{0}$, and the differential solid angle $\Delta\Omega$:

% \begin{equation}\label{eq:scattering_crossection}
%     \frac{dI_{s}}{d\Omega} = \frac{I_{s}}{\Phi_{0} \Delta\Omega}.
% \end{equation}

\section{Classical Scattering Description}\label{sec:classical_scattering}

In the classical description of scattering, the scattering vector $\vectorBU{Q}$ and the form factor $f(\vectorBU{Q})$ are characteristic properties.
$\vectorBU{Q}$ is linked to the phase shift of the scattering event, which can be understood from deriving the transfer of momentum for a wave like the one in Equation \eqref{eq:TEM_wave} before and after scattering.
The momentum transfer is defined as
\begin{equation}\label{eq:scattering_vector}
    \vectorBU{Q} = \vectorBU{k'} - \vectorBU{k},
\end{equation}
where $\vectorBU{k}$ is the incoming wave vector and $\vectorBU{k'}$ is the scattered wave vector.
In the case of elastic scattering, only the direction of the scattered wave vector changes, while the magnitude remains the same.

The form factor $f(\vectorBU{Q})$ is a function of the scattering vector $\vectorBU{Q}$, from Equation \eqref{eq:scattering_vector},
and describes the scattering of X-rays as a result of the electron density distribution.
Generally, it is the Fourier transform of the electron density distribution $\rho(\vectorBU{r})$,
\begin{equation}\label{eq:atomic_form_factor_classical}
    f(\vectorBU{Q}) = \int \rho(\vectorBU{r}) \exp\left(i\vectorBU{Q}\cdot\vectorBU{r}\right) d\vectorBU{r}.
\end{equation}
Most often the Fourier transform is defined with a negative sign in the exponential, but a positive sign has been chosen here for the purpose of the following quantum mechanical explanation in Section \ref{sec:quantum_scattering}.

Nevertheless, the observed scattering intensity $I_{s}$ is the absolute value squared of the form factor $f(\vectorBU{Q})$ from Equation \eqref{eq:atomic_form_factor_classical},
\begin{equation}\label{eq:scattering_intensity_classical}
    I_{s} \sim |f(\vectorBU{Q})|^{2}.
\end{equation}

Correspondingly, these results are supported by the Fraunhofer far-field approximation. Consider a plane wave of X-rays incident on some function, which in this case is the electron density distribution.
The corresponding intensity in Fourier space is the absolute square of the Fourier transform of the mentioned electron distribution function,
\begin{equation}\label{eq:Fraunhofer_intensity}
    I_{fd} = |F\left(\rho(r) \right) |^{2}.
\end{equation}

Anyway, from the definition of the scattering intensity, the differential scattering cross section may be defined as
\begin{equation}\label{eq:scattering_crossection}
    \frac{dI_{s}}{d\Omega} = \frac{I_{s}}{\Phi_{0} \Delta\Omega},
\end{equation}
where $\Phi_{0}$ is the incoming flux and $\Delta\Omega$ is the differential solid angle.



\section{Quantum Mechanical Explanation}\label{sec:quantum_scattering}

Even though the classical description of scattering is useful, it does not satisfy a desire to describe scattering events in terms of particle-particle interactions.
Quantum Mechanics introduces the quantisation of light, in the form of photons, which allows for a more intuitive description of scattering events.
However, a sufficient description of this evolves around several lenghty derivations, well explained by Nina Rohringer \cite{rohringer2020introduction} and Jan Malte Slowik \cite{slowik2015quantum}.
Therefore, big leaps between the essential aspects are instead included in this section.

Firstly, the quantum mechanical system must be described by a Hamiltonian. As mentioned, the system consists of X-rays, matter, and interactions between them.
The total Hamiltonian $\hat{H}$ is therefore a sum of a matter Hamiltonian $\hat{H}_{part}$, a radiation field Hamiltonian $\hat{H}_{rad}$, and an interaction Hamiltonian $\hat{H}_{int}$,
\begin{equation}\label{eq:total_Hamiltonian}
    \hat{H} = \hat{H}_{part} + \hat{H}_{rad} + \hat{H}_{int}.
\end{equation}

The Hamiltonian of the electromagnetic field, $\hat{H}_{rad}$, follows from the quantisation of the vector potential $\vectorBU{\widehat{A}}$, adopting the Coulumb gauge, $\vectorBU{\nabla} \cdot \vectorBU{\widehat{A}} = 0$.
Applying the assumptions of free, coherent, and monochromatic X-rays, the vector potential is expressed as
\begin{equation}\label{eq:qm_vector_potential}
    \vectorBU{\widehat{A}}(\vectorBU{r}) = \sum_{\vectorBU{k}, \lambda} \sqrt{\frac{2 \pi}{V \omega_{\vectorBU{k}} \alpha^{2}  }} \left( \hat{a}_{\vectorBU{k},\lambda} \vectorgreek{\epsilon}_{\vectorBU{k},\lambda} e^{i \vectorBU{k}\cdot\vectorBU{r}} + \hat{a}_{\vectorBU{k},\lambda}^{\dagger} \vectorgreek{\epsilon}_{\vectorBU{k},\lambda}^{*} e^{-i \vectorBU{k}\cdot\vectorBU{r}}  \right).
\end{equation}
The essential parameters from Equation \eqref{eq:qm_vector_potential} are the creation and annihilation operators, $\hat{a}_{\vectorBU{k},\lambda}^{\dagger}$ and $\hat{a}_{\vectorBU{k},\lambda}$, respectively.
These operators are used to describe the elastic scattering as an annihilation and a subsequent creation of a photon.
Moreover, the normalisation constant reveals the electromagnetic field to be similar to the well-known "Harmonic Oscillator" \cite{mcmorrow2011elements}. Consequently, $H_{rad}$ becomes
\begin{equation}
    \hat{H}_{rad} = \sum_{\vectorBU{k}, \lambda} \left( \hslash \omega_{\vectorBU{k}} \hat{a}_{\vectorBU{k},\lambda}^{\dagger} \hat{a}_{\vectorBU{k},\lambda}  \right).
\end{equation}

The Hamiltonian of the matter, $\hat{H}_{part}$, is the sum of the kinetic energy operator, potential energy operator, and the electronic Hamiltonian operator:
\begin{equation}\label{eq:qm_Hamiltonian_matter}
    \hat{H}_{part} = \hat{T}_{N} + \hat{V}_{NN} + \hat{H}_{el}.
\end{equation}
These are, though, of no particular interest concerning the scattering process, and are therefore not elaborated upon.

The interaction Hamiltonian, $\hat{H}_{int}$ accounts for the interaction between the electromagnetic field and the matter.
It can be shown that interactions between an electromagnetic field and charges $q$ may be accounted for by performing the substitution
$\vectorBU{p} \rightarrow \vectorBU{p}-q\vectorBU{A}$ \cite{mcmorrow2011elements}. Eventually, the interaction Hamiltonian is revealed to have a term linear and a term quadratic in the vector potential $\vectorBU{\widehat{A}}$:
\begin{equation}\label{eq:qm_interaction_Hamiltonian}
    \hat{H}_{int} \sim \vectorBU{\widehat{p}} \cdot \vectorBU{\widehat{A}} + \vectorBU{\widehat{A}}^{2}.
\end{equation}
As the first term is only linear in $\vectorBU{\widehat{A}}$, it can only account for absorption of X-rays through annihilation of photons.
The second term, however, is quadratic, and therefore accounts for annihilation and subsequent creation of photons, which is the desired interaction.
This follows from squaring Equation \eqref{eq:qm_vector_potential}, which gives terms on the form $a_{\vectorBU{k},\lambda}^{\dagger} a_{\vectorBU{k},\lambda}$.

Furthermore, second quantisation is more fitting for describing the electronic Hamiltonian and the interaction Hamiltonian when the system consists of many electrons, as the Hamiltonian in second quantisation is independent of the number of electrons \cite{rohringer2020introduction}.
Here, Fock states are introduced, and the annihilation and creation operators are replaced by annihilation and creation field operators.
The electronic density operator $\widehat{n}(\vectorBU{r})$ may be expressed in terms of these field operators as
\begin{equation}\label{eq:electronic_density_operator}
    \widehat{n}(\vectorBU{r}) =  \hat{\psi}^{\dagger}(\vectorBU{r}) \hat{\psi}( \vectorBU{r}).
\end{equation}

Next, the interaction Hamiltonian is considered a small time-dependent perturbation.
From the Time-Dependent Perturbation Theory in the interaction picture, the transition rate $\Gamma_{if}$ of excitation and subsequent recombination is derived.
The result is famously known as "Fermi's Golden Rule", and is proportional to
\begin{equation}\label{eq:fermis_golden_rule}
    \Gamma_{if} \sim \left| \langle \psi_{f} | \hat{H}_{int} | \psi_{i} \rangle \right|^{2} \rho(E_{f}).
\end{equation}
Here, $\psi_{i}$ and $\psi_{f}$ are the initial and final states, respectively, and $\rho(E_{f})$ is the density of states at the final energy $E_{f}$.
The essential part of the equation is the matrix element $\langle \psi_{f} | \hat{H}_{int} | \psi_{i} \rangle$, which is the interaction Hamiltonian evaluated in the initial and final states.

In the case of elastic scattering, the initial and final electronic states are identical, and the interaction Hamiltonian consists of the quadratic term in the vector potential $\vectorBU{\widehat{A}}$.
However, the state of the electromagnetic field changes so that one photon $\vert n_{\vectorBU{k}}\rangle$ with wave vector $\vectorBU{k}$ is annihilated and another photon $\vert n_{\vectorBU{k'}}\rangle$ with wave vector $\vectorBU{k'}$ is created \cite{mcmorrow2011elements}.

The elastic scattering rate is therefore proportional to
\begin{equation}\label{eq:qm_elastic_scattering_rate}
    \Gamma_{if} \propto \delta \left( \omega_{f} - \omega_{i} \right) \left| \int d^{3}\vectorBU{r} \langle  \Psi_{f}^{N_{el}} | \hat{\psi}^{\dagger}(\vectorBU{r}) e^{i \vectorBU{Q} \cdot \vectorBU{r} } \hat{\psi}( \vectorBU{r})  | \Psi_{i}^{N_{el}} \rangle \right|^{2}.
\end{equation}

A final evaluation of the matrix element within Equation \eqref{eq:qm_elastic_scattering_rate} by recognising the electronic density operator from Equation \eqref{eq:electronic_density_operator} yields
\begin{equation}
    M_{if} = \int d^{3}\vectorBU{r} \left. \widehat{n}(\vectorBU{r}) e^{i \vectorBU{Q} \cdot \vectorBU{r}} \right. .
\end{equation}
In other words, the matrix element is the Fourier transform of the electronic density operator, equivalent to the atomic form factor result in Equation \eqref{eq:atomic_form_factor_classical}.


