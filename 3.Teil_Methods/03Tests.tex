
\chapter{Calculations}

\section{Gradients of Alternative Functional} %Functional is function of functions

The validation of the alternative functional was conducted in stages with increasing complexity.
It was important to be able to contrast errors in the implementation from false gradient expressions.
Firstly, the gradient of a simple integer scattering model was calculated. The cost function of this model, with its gradient, is listed in Table \ref{tab:integer_model}.

% Is it actually fitting to keep this in a table? Or would equations suffice? Or necessary at all, or a part of the results?
\begin{table}[h]
    \centering
    \caption{}
    \label{tab:integer_model}
    \begin{tabular}{ l c }
        \hline
        \textbf{Cost Function}       & $\epsilon_{n} = \sum_{n', n''} ( (\sum_{n} A) - I_{n})^2 $           \\
        \textbf{Gradient Expression} & $\frac{\partial \epsilon_{n}}{\partial A} = 2 (\sum_{n} A - I_{n}) $ \\
        \hline
    \end{tabular}
\end{table}

The input data for the model in the test cases were random multidimensional arrays of the initial tomogram $A$ and the experimental intensity $I_{n}$.
The respective shapes were (2,2,2) and (3,2,2).
For each of the three 2D-projections, the forward and backward pass were performed, and the gradient expression was evaluated. %RSD: Code listing easier?
This procedure was identical to the initial testing of AD described in Section \ref{sec:proof_of_concept_AD}.

Next, the procedure was repeated using the cost function of the alternative functional, Equation \eqref{eq:exp_sin_squared}.
However, the gradients with respect to the parameters $A$ and $B$ were validated before the orientation parameters $\theta_{op}$ and $\varphi_{op}$ were handled.
Because the $\Theta$ in the cost function depends on both the orientation parameters and the lab orientation, different projection orientations were not considered.

Finally, the gradient with respect to the orientation parameters were tested.
Since the behaviour of the $A$ and $B$ parameters were known, debugging of the final implementation was easier. %?
For the test, an easy expression for the spherical position coordinate was used, as well as a simple lab coordinate. %RSD: List expressions or params. 
In addition, the final parts of the symbolic gradient expression were derived by hand. The derivation is listed in Appendix \ref{app:gradient_derivation}.


% Derivation of expressions here or in appendix? Also, orientation symbolic expressions wrong, but unsure if I have done a mistake or if there was a mistake in things derived earlier. 


\section{Reconstruction of Known Model Using Automatic Differentiation SAXSTT}

% RSD: The size was set to ... because.... Each voxel is identical, so the params are the same for each voxel. Nope, not here but in data sets. 
% Experimented a bit with starting conditions. 

\section{Comparison of Automatic and Symbolic Differentiation for SAXSTT Applied to Known Model}

% All included in results should be mentioned here, But may be located in separate chapters in results?
% Postprocessing? But unsure what I planned here. 

% Also include the new cost function. 

\section{Comparison of Cost Functions Applied on Unknown Model}% Perhaps. Test the 